{% extends "base.html" %} {% block title %}Menu - Restauracja XYZ{% endblock %}
{% block content %}
<h1>Nasze Menu</h1>
<div id="menuAccordion">
  {% for category, items in menu_items.items() %}
  <div class="card">
    <div class="card-header" id="heading{{ loop.index }}">
      <h2 class="mb-0">
        <button
          class="btn btn-link"
          type="button"
          data-toggle="collapse"
          data-target="#collapse{{ loop.index }}"
          aria-expanded="true"
          aria-controls="collapse{{ loop.index }}"
        >
          {{ category }}
        </button>
      </h2>
    </div>
    <div
      id="collapse{{ loop.index }}"
      class="collapse {% if loop.first %}show{% endif %}"
      aria-labelledby="heading{{ loop.index }}"
      data-parent="#menuAccordion"
    >
      <div class="card-body">
        {% for item in items %}
        <div class="d-flex mb-3">
          <div class="mr-3" style="max-width: 250px">
            <img
              src="{{ url_for('static', filename='images/' ~ item.image) }}"
              alt="{{ item.name }}"
              class="img-thumbnail"
              data-toggle="modal"
              data-target="#imageModal"
              data-src="{{ url_for('static', filename='images/' ~ item.image) }}"
            />
          </div>
          <div>
            <h5>{{ item.name }}</h5>
            <p>{{ item.description }}</p>
            <p><strong>Cena: {{ item.price }} PLN</strong></p>
            {% if session.get('logged_in') %}
            <form method="POST" action="/menu" class="add-to-cart-form">
              <input type="hidden" name="item_name" value="{{ item.name }}" />
              <input
                type="hidden"
                name="item_description"
                value="{{ item.description }}"
              />
              <input type="hidden" name="item_price" value="{{ item.price }}" />
              <div class="form-group">
                <label for="quantity">Ilość</label>
                <input
                  type="number"
                  class="form-control"
                  name="quantity"
                  value="1"
                  min="1"
                  required
                />
              </div>
              <button type="submit" class="btn btn-primary">
                Dodaj do koszyka
              </button>
            </form>
            {% else %}
            <p class="text-danger">Zaloguj się, aby dodać do koszyka.</p>
            {% endif %}
          </div>
        </div>
        {% endfor %}
      </div>
    </div>
  </div>
  {% endfor %}
</div>

<!-- Modal -->
<div
  class="modal fade"
  id="imageModal"
  tabindex="-1"
  aria-labelledby="imageModalLabel"
  aria-hidden="true"
>
  <div class="modal-dialog modal-dialog-centered modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="imageModalLabel">Podgląd obrazka</h5>
        <button
          type="button"
          class="close"
          data-dismiss="modal"
          aria-label="Close"
        >
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <img id="modalImage" src="" alt="Podgląd" class="img-fluid" />
      </div>
    </div>
  </div>
</div>

<script>
  $(document).ready(function () {
    $(".add-to-cart-form").on("submit", function (event) {
      event.preventDefault();

      $.ajax({
        type: "POST",
        url: "/menu",
        data: $(this).serialize(),
        success: function (response) {
          location.reload();
        },
      });
    });

    $("#imageModal").on("show.bs.modal", function (event) {
      var button = $(event.relatedTarget); // Element, który wywołał modal
      var src = button.data("src"); // Pobranie wartości data-src
      var modal = $(this);
      modal.find("#modalImage").attr("src", src); // Ustawienie src obrazka
    });
  });
</script>
{% endblock %}
